; ============================================================================
; Native Test Environment (x86/x64) - TESTING_STANDARDS.md ยง2
; ============================================================================
[env:native]
platform = native
build_flags =
    -D NATIVE_BUILD                # Flag to exclude hardware code
    -D STM32F4xx                   # Use STM32 code path (not AVR)
    -I test/mocks                  # Include mock headers
    -I src/headers                 # Project headers  
    -std=c++17                     # Modern C++
build_src_filter =
    +<src/>                        # Include all src files
    -<src/main.cpp>                # Exclude main application
test_filter = native/*             # Only run native tests

; ============================================================================
; STM32F411CE Black Pill - Hardware Test Environment
; ============================================================================
[env:blackpill_f411ce]
platform = ststm32
board = blackpill_f411ce
framework = arduino
upload_protocol = stlink
; upload_protocol = dfu  ; Uncomment to use DFU mode instead
monitor_port = COM8
monitor_speed = 115200

; Enable USB Serial
build_flags = 
    ; GEMINI.md Rule 10: Strict Compilation (Adapted for Embedded)
    ; Note: -Wpedantic removed - breaks STM32 HAL framework (empty TUs, enum ranges)
    -Wall                   ; Enable all standard warnings
    -Wextra                 ; Enable extra warnings (unused params, sign comparisons)
    -Werror                 ; Treat ALL warnings as errors
    
    ; Framework configuration
    -D PIO_FRAMEWORK_ARDUINO_ENABLE_CDC
    -D USBCON
    -D USBD_VID=0x0483
    -D USBD_PID=0x5740
    -D USB_MANUFACTURER=\"Unknown\"
    -D USB_PRODUCT=\"BLACKPILL_F411CE\"
    -D HAL_PCD_MODULE_ENABLED
    -D HAL_PKA_MODULE_DISABLED

lib_deps=
    https://github.com/fdebrabander/Arduino-LiquidCrystal-I2C-library.git
    https://github.com/ArminJo/LCDBigNumbers.git
    khoih-prog/FlashStorage_STM32@^1.2.0

; Hardware test configuration
test_port = COM8
test_speed = 115200
test_filter = hardware/*

